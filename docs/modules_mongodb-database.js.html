<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: modules/mongodb-database.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: modules/mongodb-database.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict'

/** MongoDB Database Interactions modules
 * @module modules/mongodb-database
 * @requires mongodb
 */

// Import package for mongodb client
const MongoClient = require('mongodb').MongoClient
const mongodb = require('mongodb')

// Name of the MongoDB database used for the application
const databaseName = 'yummy_recipes_db'

/**
 * Add one resource to MongoDB for the provided database and collection
 * @param {string} databaseURL - Address of MongoDB database you want to use
 * @param {string} collectionName - Collection you want to add the new resource to
 * @param {Object} newResource - Object representing a the resource you want to add
 * @returns {Promise} Promise object representing the result of adding a new resource to the provided database/collection
 */
exports.addResourceToCollection = (databaseURL, collectionName, newResource) => new Promise((resolve, reject) => {

	// Log to confirm a request has been made to add a new resource to the provided database and collection
	console.log('New resource being added to database: ' + databaseName + '. collection: ' + collectionName)

	// Connect to the mongodb database
	// Once done, runs the callback to execute the query to add a new resource to the given collection
	MongoClient.connect(databaseURL, (err, db) => {

		// If error, reject the promise with a new error object
		if(err)	reject(new Error('Unable to connect to MongoDB'))

		try {
			// Create an instance of the mongodb database
			const dbo = db.db(databaseName)

			// MongoDB query to insert one document into the provided collection
			dbo.collection(collectionName).insertOne(newResource, (err, result) => {

				// Log to confirm document was successfully inserted
				console.log('Document inserted to mongodb database: ' + databaseName + ', collection: ' + collectionName)

				// Close database connection
				db.close()

				// Resolve the promise with true to confirm the insert has successfully completed
				resolve(true)
			})

		} catch (err) {
			// If error, reject the promise with an error object
			reject(new Error('Unable to connect to MongoDB'))
		}
	})
})

/**
 * Retrieve all resources from MongoDB for the provided database, collection and query
 * @param {string} databaseURL - Address of MongoDB database you want to use
 * @param {string} collectionName - Collection you want to retrieve resources from
 * @param {Object} [searchObject] - Optional query to specify criteria for which resources to retrieve. Retrieves all if no query object provided
 * @param {Object} [paginationObject] - Optional arguments to sort, limit or offset the returned results
 * @returns {Promise} Promise object representing the result of retrieving resources from the provided database/collection
 */
exports.getAllFromCollection = (databaseURL, collectionName, searchObject, paginationObject, sortObject) => new Promise((resolve, reject) => {

	// Connect to the mongodb database
	// Once done, runs the callback to execute the query to find all resources in the given collection
	MongoClient.connect(databaseURL, (err, db) => {

		// If there's an error from the function call, reject the promise with an error object
		if(err)	reject(new Error('Unable to connect to MongoDB'))

		try {
			// Create an instance of the mongodb database
			const dbo = db.db(databaseName)

			// Mongodb query to find all resources from the collection and save it to an array called result
			// Once completed, pass the result array as the resolve parameter of the promise
			// Uses the searchObject and query parameters if they are provided
			dbo.collection(collectionName).find(searchObject).skip(paginationObject.skip).limit(paginationObject.limit).sort(sortObject).toArray((err, result) => {

				// Log to confirm query was successfully performed
				console.log('Requesting documents from mongodb database')

				// Close database connection
				db.close()

				// Resolve the promise with true to confirm the find query has successfully completed
				resolve(result)
			})

		} catch (err) {
			// If error, reject the promise with an error object
			reject(new Error('Unable to connect to MongoDB'))
		}
	})
})

/**
 * Retrieve one resource from MongoDB for the provided database, collection and resource id
 * @param {string} databaseURL - Address of MongoDB database you want to use
 * @param {string} collectionName - Collection you want to retrieve the resource from
 * @param {Object} resourceID - Specifies the id of the resource to retrieve
 * @returns {Promise} Promise object representing the result of retrieving the resource from the provided database/collection
 */
exports.getResourceFromCollection = (databaseURL, collectionName, resourceID) => new Promise((resolve, reject) => {

	// Connect to the mongodb database
	// Once done, runs the callback to execute the query to find a resouce using the provided id in the given collection
	MongoClient.connect(databaseURL, (err, db) => {

		// If there's an error from the function call, reject the promise with an error object
		if(err)	reject(new Error('Unable to connect to MongoDB'))

		try {
			// Create an instance of the mongodb database
			const dbo = db.db(databaseName)

			// Mongodb query to find one resource from the collection based on its id and saves the result
			// Once completed, pass the result as the resolve parameter of the promise
			dbo.collection(collectionName).findOne({'_id': new mongodb.ObjectId(resourceID)}, (err, result) => {

				// Log to confirm query was successfully performed
				console.log('Requesting one document from mongodb database')

				// Close database connection
				db.close()

				// Resolve the promise with true to confirm the find query has successfully completed
				resolve(result)
			})

		} catch (err) {
			// If error, reject the promise with an error object
			reject(new Error('Unable to connect to MongoDB'))
		}
	})
})

/**
 * Update one resource from MongoDB for the provided database, collection, resource id and new resource object
 * @param {string} databaseURL - Address of MongoDB database you want to use
 * @param {string} collectionName - Collection you want to update a resource in
 * @param {Object} resourceID - Specifies the id of the resource to update
 * @returns {Promise} Promise object representing the result of updating the resource in the provided database/collection
 */
exports.updateResource = (databaseURL, collectionName, resourceID, newValuesObject) => new Promise((resolve, reject) => {

	// Connect to the mongodb database
	// Once done, runs the callback to execute the query to update the resource matching the id
	MongoClient.connect(databaseURL, (err, db) => {

		// If there's an error from the function call, reject the promise with an error object
		if(err)	reject(new Error('Unable to connect to MongoDB'))

		try {
			// Create an instance of the mongodb database
			const dbo = db.db(databaseName)

			// Mongodb query to update one resource from the collection using the id, collection and new object provided
			// Once completed, resolves the promise as true to confirm the update completed
			dbo.collection(collectionName).updateOne({_id: new mongodb.ObjectID(resourceID)}, {$set: newValuesObject}, (err, result) => {

				// Log to confirm the resource was successfully updated
				console.log('Resource with id ' + resourceID + ' has been updated')

				// Close database connection
				db.close()

				// Resolve the promise with true to confirm the update query has successfully completed
				resolve(true)
			})

		} catch (err) {
			// If error, reject the promise with an error object
			reject(new Error('Unable to connect to MongoDB'))
		}
	})
})

/**
 * Delete one resource from MongoDB for the provided database, collection and resource id
 * @param {string} databaseURL - Address of MongoDB database you want to use
 * @param {string} collectionName - Collection you want to delete a resource in
 * @param {Object} resourceID - Specifies the id of the resource to delete
 * @returns {Promise} Promise object representing the result of deleting the resource in the provided database/collection
 */
exports.deleteResource = (databaseURL, collectionName, resourceID) => new Promise((resolve, reject) => {

	// Connect to the mongodb database
	// Once done, runs the callback to execute the query to delete one resource matching the id
	MongoClient.connect(databaseURL, (err, db) => {

		// If there's an error from the function call, reject the promise with an error object
		if(err)	reject(new Error('Unable to connect to MongoDB'))

		try {
			// Create an instance of the mongodb database
			const dbo = db.db(databaseName)

			// Mongodb query to delete one resource from the collection using the id
			// Once completed, resolves the promise as true to confirm deleting the resource was completed
			dbo.collection(collectionName).deleteOne({_id: new mongodb.ObjectID(resourceID)}, (err, result) => {

				// Log to confirm the resource was successfully deleted
				console.log('Resource with id ' + resourceID + ' has been deleted')

				// Close database connection
				db.close()

				// Resolve the promise with true to confirm the update query has successfully completed
				resolve(true)
			})

		} catch (err) {
			// If error, reject the promise with an error object
			reject(new Error('Unable to connect to MongoDB'))
		}
	})
})
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-api-server.html">api-server</a></li><li><a href="module-modules_authentication.html">modules/authentication</a></li><li><a href="module-modules_images-controller.html">modules/images-controller</a></li><li><a href="module-modules_mongodb-database.html">modules/mongodb-database</a></li><li><a href="module-modules_notifications-controller.html">modules/notifications-controller</a></li><li><a href="module-modules_ratings-controller.html">modules/ratings-controller</a></li><li><a href="module-modules_recipes-controller.html">modules/recipes-controller</a></li><li><a href="module-modules_users-controller.html">modules/users-controller</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Fri Dec 14 2018 14:48:23 GMT+0000 (Greenwich Mean Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
